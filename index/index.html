<html>
<script>
var ws = new WebSocket("ws://192.168.1.16:8080/ws");
ws.onopen = function() {
    console.log("websocket open succeed");
};

ws.onmessage = function(evt) {
    var maze_data = JSON.parse(evt.data);

    var maze = parse_array(maze_data["maze"],maze_data["width"],maze_data["height"]);
    var is_goal = parseInt(maze_data["is_goal"]);
    var player_x = parseInt(maze_data["player_x"]);
    var player_y = parseInt(maze_data["player_y"]);
    var start_x = parseInt(maze_data["start_x"]);
    var start_y = parseInt(maze_data["start_y"]);
    var goal_x = parseInt(maze_data["goal_x"]);
    var goal_y = parseInt(maze_data["goal_y"]);
    var screen_width = parseInt(maze_data["width"]);
    var screen_height = parseInt(maze_data["height"]);
    display_canvas(maze,start_x,start_y,goal_x,goal_y,player_x,player_y,screen_width,screen_height);
    console.log(player_x,player_y);
};

function display_canvas(maze,start_x,start_y,goal_x,goal_y,player_x,player_y,width,height){
    var canvas = document.getElementById('map');
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = 'rgb(255,255,0)';
    ctx.fillRect(0,0,870,450);
    for(y=0;y<height;y++){
        for(x=0;x<width;x++){
            if(x == start_x && y == start_y){
                ctx.fillStyle = 'rgb(0,128,0)'
                ctx.fillRect(x*30,y*30,30,30);
            }else if(x == goal_x && y == goal_y){
                ctx.fillStyle = 'rgb(255,0,0)'
                ctx.fillRect(x*30,y*30,30,30);
            }else if(maze[y][x] == 1){
                ctx.fillStyle = 'rgb(255,255,255)'
                ctx.fillRect(x*30,y*30,30,30);
            }
            if(x == player_x && y == player_y){
                ctx.fillStyle = 'rgb(0,0,0)';
                ctx.beginPath();
                ctx.arc(x*30+15,y*30+15,10,0,Math.PI*2,false);
                ctx.fill();
            }
        }
    }
}

function parse_array(mazedata,width,height){
    var ary = mazedata.split(' ');
    var ret = new Array();
    n = 0;
    for(y=0;y<height;y++){
        ret[y] = new Array();
        for(x=0;x<width;x++){
            ret[y][x] = parseInt(ary[n]);
            n++;
        }
    }
    return ret
}
</script>
<body>
    <canvas id="map" width="870" height="450" style="background-color:yellow";></canvas>
</body>
</html>
